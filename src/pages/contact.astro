---
const isDev = import.meta.env.DEV;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>
      Contact | David&#39;s Neighbour
    </title>
    <meta name="description" content="" />
    <link href="https://davids-neighbour.com/css/theme.css" rel="stylesheet" />
    <link rel="canonical" href="https://davids-neighbour.com/contact/" />
    <meta name="description" content="Onlinemarketing Made in Paradise" />
    <link rel="alternate" type="application/rss+xml" href="https://davids-neighbour.com/contact/index.xml" />
    <meta name="robots" content="index, follow, archive" />
    <link rel="manifest" href="/manifest.webmanifest" />
  </head>
  <body class="font-sans font-base font-normal leading-snug bg-gray-100 text-gray-800">
    <div class="flex flex-col h-screen gap-y-4">
      <main class="p-4 flex-grow container mx-auto">
        <section class="text-gray-600 body-font relative">
          <div class="container mx-auto flex sm:flex-nowrap flex-wrap">
            <div
              class="lg:w-2/3 md:w-1/2 bg-gray-300 rounded-lg overflow-hidden p-10 flex items-end justify-start relative"
            >
              <iframe
                width="100%"
                height="100%"
                class="absolute inset-0"
                frameborder="0"
                marginheight="0"
                marginwidth="0"
                scrolling="no"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3934.194813678517!2d99.95610221528483!3d9.578469082776888!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3054f762b41352cd%3A0x9cc2bddbde0d389c!2sDavid's%20Neighbour!5e0!3m2!1sen!2sth!4v1628394373876!5m2!1sen!2sth&zoom=7"
                style="filter: grayscale(1) contrast(1.2) opacity(0.4);"></iframe>
              <div class="bg-white relative flex flex-wrap py-6 rounded shadow-md w-full">
                <div class="lg:w-1/2 px-6">
                  <h2 class="title-font font-semibold text-gray-900 text-sm">David&#39;s Neighbour Part., Ltd.</h2>
                  <p class="mt-1">
                    Patrick Kollitsch<br />P.O.Box 135, Post Office Maenam<br />84330 Suratthani, Koh Samui<br
                    />Thailand
                  </p>
                </div>
                <div class="lg:w-1/2 px-6 mt-4 lg:mt-0">
                  <h2 class="title-font font-regular text-gray-900 text-sm">WhatsApp</h2><a
                    class="text-indigo-500"
                    href="https://wa.me/66878979350?&lang=en">Contact me</a
                  >

                  <h2 class="title-font font-regular text-gray-900 text-sm">Signal</h2><span class="text-indigo-500"
                    >davidsneighbour</span
                  >

                  <h2 class="title-font font-regular text-gray-900 text-sm">Telegram</h2><a
                    class="text-indigo-500"
                    href="https://t.me/davidsneighbour">davidsneighbour</a
                  >
                </div>
              </div>
            </div>
            <div class="lg:w-1/3 md:w-1/2 bg-white flex flex-col md:ml-auto w-full md:p-8 mt-8 md:mt-0">
              <form
                name="contact"
                method="POST"
                action="/.netlify/functions/send-email"
                novalidate
              >
                <h2 class="text-gray-900 text-lg mb-1 font-medium title-font">Feedback</h2>
                <p class="leading-relaxed mb-5 text-gray-600">Send me a message</p>
                <p class="leading-relaxed mb-4 text-sm text-green-500 hidden" data-form-status role="status" aria-live="polite"></p>
                <div class="relative mb-4">
                  <label for="name" class="leading-7 text-sm text-gray-600">Your Name</label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    enterkeyhint="next"
                    aria-required="true"
                    aria-describedby="name-error"
                    class="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                  />
                  <p id="name-error" data-error-for="name" class="mt-2 text-sm text-red-500 hidden" role="alert"></p>
                </div>
                <div class="relative mb-4">
                  <label for="email" class="leading-7 text-sm text-gray-600">Your Email</label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    enterkeyhint="next"
                    aria-required="true"
                    aria-describedby="email-error"
                    class="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                  />
                  <p id="email-error" data-error-for="email" class="mt-2 text-sm text-red-500 hidden" role="alert"></p>
                </div>
                <div class="relative mb-4">
                  <label for="message" class="leading-7 text-sm text-gray-600">Your Message</label>
                  <textarea
                    id="message"
                    name="message"
                    required
                    enterkeyhint="enter"
                    aria-required="true"
                    aria-describedby="message-error"
                    class="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 h-32 text-base outline-none text-gray-700 py-1 px-3 resize-none leading-6 transition-colors duration-200 ease-in-out"
                  ></textarea>
                  <p id="message-error" data-error-for="message" class="mt-2 text-sm text-red-500 hidden" role="alert"></p>
                </div>
                <p class="hidden">
                  <label>
                    Don't fill this out if you're human:
                    <input name="fvsdg4" type="text" />
                  </label>
                </p>
                <button
                  type="submit"
                  class="text-white bg-indigo-500 border-0 py-2 px-6 focus:outline-none hover:bg-indigo-600 rounded text-lg"
                  >Send Message</button
                >
                <p class="text-xs text-gray-500 mt-3">I will try to reply as soon as possible.</p>
              </form>
            </div>
          </div>
        </section>
      </main>
    </div>
    <script>
      (() => {
        const form = document.querySelector('form[name="contact"]');
        if (!form) {
          // Silent failure if form not present
          return;
        }

        const isDevEnv = ${isDev ? "true" : "false"};
        const url = new URL(location.href);
        const scenario = url.searchParams.get('scenario') || 'success';
        const preview = ['1','true','yes','on'].includes((url.searchParams.get('preview')||'').toLowerCase());
        const toolbar = ['1','true','yes','on'].includes((url.searchParams.get('toolbar')||'').toLowerCase());
        const simulatorEnabled = isDevEnv && (preview || toolbar || url.searchParams.has('scenario'));

        const statusEl = form.querySelector('[data-form-status]');
        const submitButton = form.querySelector('button[type="submit"]');
        const errorEls = new Map(
          Array.from(form.querySelectorAll('[data-error-for]')).map((el) => [el.getAttribute('data-error-for'), el])
        );
        const required = ['name','email','message'];
        const keywords = {
          name: ['name'],
          email: ['email'],
          message: ['message'],
        };

        const setStatus = (type, message) => {
          try {
            if (!statusEl) return;
            statusEl.textContent = message;
            statusEl.classList.remove('hidden','text-red-500','text-green-500');
            statusEl.setAttribute('role', type === 'error' ? 'alert' : 'status');
            statusEl.classList.add(type === 'error' ? 'text-red-500' : 'text-green-500');
          } catch {}
        };
        const clearStatus = () => {
          try {
            if (!statusEl) return;
            statusEl.textContent = '';
            statusEl.classList.add('hidden');
            statusEl.classList.remove('text-red-500','text-green-500');
            statusEl.setAttribute('role','status');
          } catch {}
        };
        const clearFieldErrors = () => {
          try {
            for (const [name, el] of errorEls) {
              if (!name) continue;
              el.textContent = '';
              el.classList.add('hidden');
              const field = form.querySelector(`[name="${name}"]`);
              field?.removeAttribute('aria-invalid');
              field?.classList.remove('outline-red-500','focus:outline-red-500');
            }
          } catch {}
        };
        const setFieldError = (name, message) => {
          try {
            const field = form.querySelector(`[name="${name}"]`);
            const el = errorEls.get(name);
            if (!field || !el) return;
            el.textContent = message;
            el.classList.remove('hidden');
            field.setAttribute('aria-invalid','true');
            field.classList.add('outline-red-500','focus:outline-red-500');
          } catch {}
        };
        const handleError = (message) => {
          const msg = message || 'Something went wrong. Please try again later.';
          setStatus('error', msg);
          if (!message) { required.forEach(n => setFieldError(n, msg)); return; }
          const lowered = msg.toLowerCase();
          let matched = false;
          for (const [name, keys] of Object.entries(keywords)) {
            if (keys.some(k => lowered.includes(k))) { setFieldError(name, msg); matched = true; }
          }
          if (!matched) required.forEach(n => setFieldError(n, msg));
        };

        const submitRealRequest = async (event) => {
          event.preventDefault();
          clearStatus(); clearFieldErrors();

          const formData = new FormData(form);
          const payload = {
            name: (formData.get('name') || '').toString().trim(),
            email: (formData.get('email') || '').toString().trim(),
            message: (formData.get('message') || '').toString().trim(),
            honeyPot: (formData.get('fvsdg4') || '').toString().trim(),
          };

          try {
            submitButton?.setAttribute('disabled','true');
            submitButton?.classList.add('opacity-70');

            const response = await fetch(form.action, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
              body: JSON.stringify(payload),
            });

            let result = {};
            try { result = await response.json(); } catch {}

            if (response.ok) {
              setStatus('success', result.message || 'Thank you for your message!');
              form.reset();
            } else {
              const errorMessage = result && (result.error || result.message);
              handleError(typeof errorMessage === 'string' ? errorMessage : undefined);
            }
          } catch {
            handleError('Network error. Please try again in a moment.');
          } finally {
            submitButton?.removeAttribute('disabled');
            submitButton?.classList.remove('opacity-70');
          }
        };

        if (!simulatorEnabled) {
          form.addEventListener('submit', submitRealRequest);
          return;
        }

        const simulate = (sc) => {
          switch (sc) {
            case 'success':        return { ok: true, message: 'Thank you for your message!' };
            case 'name-missing':   return { ok: false, error: 'Name is required.' };
            case 'email-missing':  return { ok: false, error: 'Email is required.' };
            case 'invalid-email':  return { ok: false, error: 'Please enter a valid email address.' };
            case 'message-missing':return { ok: false, error: 'Message is required.' };
            case 'server-500':     return { ok: false, status: 500, error: 'Internal Server Error' };
            case 'network':        throw Object.assign(new Error('Simulated network error'), { isNetworkError: true });
            default:               return { ok: false, error: `Unknown scenario: ${sc}` };
          }
        };

        form.addEventListener('submit', async (ev) => {
          ev.preventDefault();
          clearStatus(); clearFieldErrors();
          try {
            await new Promise(r => setTimeout(r, 250));
            const result = simulate(scenario);
            if (result.ok) { setStatus('success', result.message || 'OK'); form.reset(); }
            else { handleError(result.error || 'Error'); }
          } catch (e) {
            handleError('Network error. Please try again in a moment.');
          }
        }, { capture: true });

        if (toolbar) {
          const container = form.querySelector('.mx-auto') || form;
          const bar = document.createElement('div');
          bar.style.position = 'sticky';
          bar.style.top = '0';
          bar.style.zIndex = '50';
          bar.style.display = 'flex';
          bar.style.flexWrap = 'wrap';
          bar.style.gap = '.5rem';
          bar.style.padding = '.5rem';
          bar.style.marginBottom = '.75rem';
          bar.style.background = 'rgba(2,6,23,.8)';
          bar.style.border = '1px solid rgba(148,163,184,.3)';
          bar.style.borderRadius = '.5rem';
          const addBtn = (label, sc) => {
            const b = document.createElement('button');
            b.type = 'button'; b.textContent = label;
            b.style.padding = '.35rem .6rem';
            b.style.border = '1px solid rgba(148,163,184,.4)';
            b.style.borderRadius = '.375rem';
            b.addEventListener('click', () => {
              clearStatus(); clearFieldErrors();
              try {
                const r = simulate(sc);
                r.ok ? setStatus('success', r.message || 'OK') : handleError(r.error || 'Error');
              } catch { handleError('Network error. Please try again in a moment.'); }
            });
            return b;
          };
          bar.append(
            addBtn('Success','success'),
            addBtn('Name missing','name-missing'),
            addBtn('Email missing','email-missing'),
            addBtn('Invalid email','invalid-email'),
            addBtn('Message missing','message-missing'),
            addBtn('Server 500','server-500'),
            addBtn('Network','network'),
          );
          const clearBtn = addBtn('Clear','__clear__');
          clearBtn.addEventListener('click', () => { clearStatus(); clearFieldErrors(); });
          bar.append(clearBtn);
          container.prepend(bar);
        }

        if (preview) {
          try {
            const r = simulate(scenario);
            r.ok ? setStatus('success', r.message || 'OK') : handleError(r.error || 'Error');
          } catch { handleError('Network error. Please try again in a moment.'); }
        }
      })();
    </script>
  </body>
</html>
